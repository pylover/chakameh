#:import AudioPlayer chakameh.gui.player.AudioPlayer
#:import PlayButton chakameh.gui.player.PlayButton
#:import adapters chakameh.gui.adapters
#:import States chakameh.gui.player.States

[AccordionItemTitle@Label]:
  text: ctx.title
  canvas.before:
    Color:
      rgb: 1, 1, 1
    BorderImage:
      source: 
        ctx.item.background_normal \
        if ctx.item.collapse \
        else ctx.item.background_selected
      pos: self.pos
      size: self.size
    PushMatrix
    Translate:
      xy: self.center_x, self.center_y
    Rotate:
      angle: 90 if ctx.item.orientation == 'horizontal' else 0
      axis: 0, 0, 1
    Translate:
      xy: -self.center_x, -self.center_y
  canvas.after:
    PopMatrix

Widget:
  BoxLayout:
    size: root.size
    pos: root.pos
    orientation: 'vertical'
    AudioPlayer:
      source: "/home/vahid/AptanaStudioWorkspace/chakameh/source/chakameh/gui/test.mp3"
      size_hint: 1, .08
      font_size: '20sp'
      text: 'vahid'
      color: 1,0,0,1
    BoxLayout:
      size_hint: 1, .92
      orientation: 'horizontal'
  
      # Main Detail View
      BoxLayout:
        orientation: 'vertical'
        size_hint: .9, 1
        BoxLayout:
          orientation: 'horizontal'
          size_hint: 1, None
          height: 32
          ToggleButton:
            size_hint: .12, 1
            text: 'دستگاه'
            halign: 'right'
          ToggleButton:
            size_hint: .12, 1
            text: 'شاعر'
            halign: 'right'
          ToggleButton:
            size_hint: .12, 1
            text: 'آهنگساز'
            halign: 'right'
          ToggleButton:
            size_hint: .12, 1
            text: 'خواننده'
            halign: 'right'
          ToggleButton:
            size_hint: .43, 1
            text: 'عنوان'
            halign: 'right'
          ToggleButton:
            size_hint: .07, 1
            text: 'کد'
            halign: 'left'            
        ListView:
          size_hint: 1, .92
          adapter:
            adapters.TrackAdapter(template="DetailedListItem")
        StackLayout:
          orientation: 'rl-tb'
          size_hint: 1, .04        
            
      #Right Pane
      Accordion:
        size_hint: .2, 1
        orientation: 'vertical'
        AccordionItem:          
          title: 'خواننده'
          ListView:
            adapter:
              adapters.ArtistAdapter()
        AccordionItem:
          title: 'شاعر'
          ListView:
            adapter:
              adapters.LyricistAdapter()            
        AccordionItem:
          title: 'دستگاه'     
          ListView:
            adapter:
              adapters.GenereAdapter()            
        AccordionItem:
          title: 'آهنگساز'
          ListView:
            adapter:
              adapters.ComposerAdapter()

<ListItemButton>:
  background_color: .2,.2,.2,1
  deselected_color: .2,.2,.2,1
  selected_color: 0,.4,.8,1

[SimpleListItem@SelectableView+BoxLayout]:
  size_hint_y: None
  height: 32
  ListItemButton:
    text: ctx.model.title
    is_selected: False        

<Label>:
  font_name: 'IranianSans'
  text_size: self.width - 10, None
  font_size: 14
  
<ToggleButton>:
  background_color: .2,.2,.2,1

[DetailedListItem@SelectableView+BoxLayout]:
  size_hint_y: None
  height: 32
  orientation: 'horizontal'
  
  ListItemButton:
    size_hint: .12, 1
    text: '' if not ctx.model.genere else ctx.model.genere.title
    halign: 'right'
    font_size: 10
  ListItemButton:
    size_hint: .12, 1
    text: '' if not ctx.model.lyricist else ctx.model.lyricist.title
    halign: 'right'
    font_size: 10
  ListItemButton:
    size_hint: .12, 1
    text: '' if not ctx.model.composer else ctx.model.composer.title
    halign: 'right'
    font_size: 10
  ListItemButton:
    size_hint: .12, 1
    text: '' if not ctx.model.artist else ctx.model.artist.title
    halign: 'right'
    font_size: 10
  ListItemButton:
    size_hint: .43, 1
    text: ctx.model.title
    halign: 'right'
  ListItemButton:
    size_hint: .07, 1
    text: ctx.model.code
    halign: 'left'
    
<AudioPlayer>:
  orientation: 'horizontal'
  spacing: 4
  # PrevButton:
    # size_hint: .04,1
  PlayButton:
    size_hint_x: None
    player: root
    width: 44
    source: 
      'atlas://data/images/defaulttheme/media-playback-pause' if root.player_state == States.PLAYING \
      else 'atlas://data/images/defaulttheme/media-playback-start'
  Slider:
    size_hint: .8,1
    pos_hint_right: 0
    value: root.position

<PlayButton>:
  text: ""
  background_color: 0,0,0,0
  padding: 17 * self.width / 100.0

<PrevButton>:
#  padding: 17 * self.width / 100.0
  text: ""
  background_color: 0,0,0,0
  background_normal: 'atlas:///home/vahid/AptanaStudioWorkspace/kivy/kivy/data/images/defaulttheme/bubble_btn'
  # canvas:
    # Line:
      # close: True
      # joint: 'round'
      # width: 2
      # points: self.right-self.padding, self.top-self.padding, self.x+self.padding,self.y + self.height / 2.0, self.right-self.padding, self.y+self.padding
    # Line:
      # width: 2
      # points: self.x + self.padding,self.y + self.padding, self.x+self.padding,self.top - self.padding

<NextButton>:
  padding: 17 * self.width / 100.0
  text: ""
  background_color: 0,0,0,0
  canvas:
    Line: 
      close: True
      joint: 'round'
      width: 2
      points: self.x+self.padding,self.top-self.padding, self.right-self.padding,self.y + self.height / 2.0, self.x+self.padding, self.y+self.padding
    Line:
      width: 2
      points: self.right - self.padding,self.y + self.padding, self.right-self.padding,self.top - self.padding
      
        
